<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Web App API Test</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-button {
            background: #0088cc;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        .test-button:hover {
            background: #006699;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç Telegram Web App API</h1>
    
    <div class="test-section">
        <h3>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API</h3>
        <button class="test-button" onclick="testAvailability()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å</button>
        <div id="availability-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>2. –¢–µ—Å—Ç sendData</h3>
        <button class="test-button" onclick="testSendData()">–¢–µ—Å—Ç sendData</button>
        <div id="senddata-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>3. –¢–µ—Å—Ç postEvent</h3>
        <button class="test-button" onclick="testPostEvent()">–¢–µ—Å—Ç postEvent</button>
        <div id="postevent-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>4. –¢–µ—Å—Ç MainButton</h3>
        <button class="test-button" onclick="testMainButton()">–¢–µ—Å—Ç MainButton</button>
        <div id="mainbutton-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>5. –¢–µ—Å—Ç BackButton</h3>
        <button class="test-button" onclick="testBackButton()">–¢–µ—Å—Ç BackButton</button>
        <div id="backbutton-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>6. –¢–µ—Å—Ç –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤</h3>
        <button class="test-button" onclick="testAllMethods()">–¢–µ—Å—Ç –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤</button>
        <div id="allmethods-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>7. –ö–æ–Ω—Å–æ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã</h3>
        <p>–í—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–∏ –∫–æ–º–∞–Ω–¥—ã –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12):</p>
        <div class="result info">
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—ä–µ–∫—Ç Telegram
console.log('Telegram object:', window.Telegram);

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å WebApp –æ–±—ä–µ–∫—Ç
console.log('WebApp object:', window.Telegram?.WebApp);

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã
if (window.Telegram?.WebApp) {
    console.log('Available methods:', Object.getOwnPropertyNames(window.Telegram.WebApp));
}

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å sendData
if (window.Telegram?.WebApp?.sendData) {
    console.log('sendData available:', typeof window.Telegram.WebApp.sendData);
}

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å postEvent
if (window.Telegram?.WebApp?.postEvent) {
    console.log('postEvent available:', typeof window.Telegram.WebApp.postEvent);
}
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        let tg = window.Telegram?.WebApp;
        
        if (tg) {
            tg.ready();
            tg.expand();
        }
        
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `result ${type}`;
        }
        
        function testAvailability() {
            const result = {
                'window.Telegram': !!window.Telegram,
                'window.Telegram.WebApp': !!window.Telegram?.WebApp,
                'tg.ready': !!tg?.ready,
                'tg.expand': !!tg?.expand,
                'tg.sendData': !!tg?.sendData,
                'tg.postEvent': !!tg?.postEvent,
                'tg.MainButton': !!tg?.MainButton,
                'tg.BackButton': !!tg?.BackButton
            };
            
            showResult('availability-result', JSON.stringify(result, null, 2), 'success');
        }
        
        function testSendData() {
            if (!tg?.sendData) {
                showResult('senddata-result', '‚ùå sendData –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
                return;
            }
            
            try {
                const testData = {
                    command: 'test',
                    data: { message: 'Hello from sendData' },
                    timestamp: Date.now()
                };
                
                const result = tg.sendData(JSON.stringify(testData));
                showResult('senddata-result', `‚úÖ sendData –≤—ã–ø–æ–ª–Ω–µ–Ω\n–†–µ–∑—É–ª—å—Ç–∞—Ç: ${result}\n–î–∞–Ω–Ω—ã–µ: ${JSON.stringify(testData, null, 2)}`, 'success');
            } catch (error) {
                showResult('senddata-result', `‚ùå –û—à–∏–±–∫–∞ sendData: ${error.message}`, 'error');
            }
        }
        
        function testPostEvent() {
            if (!tg?.postEvent) {
                showResult('postevent-result', '‚ùå postEvent –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
                return;
            }
            
            try {
                const testData = {
                    command: 'test',
                    data: { message: 'Hello from postEvent' },
                    timestamp: Date.now()
                };
                
                const result = tg.postEvent('web_app_data_send', testData);
                showResult('postevent-result', `‚úÖ postEvent –≤—ã–ø–æ–ª–Ω–µ–Ω\n–†–µ–∑—É–ª—å—Ç–∞—Ç: ${result}\n–î–∞–Ω–Ω—ã–µ: ${JSON.stringify(testData, null, 2)}`, 'success');
            } catch (error) {
                showResult('postevent-result', `‚ùå –û—à–∏–±–∫–∞ postEvent: ${error.message}`, 'error');
            }
        }
        
        function testMainButton() {
            if (!tg?.MainButton) {
                showResult('mainbutton-result', '‚ùå MainButton –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
                return;
            }
            
            try {
                tg.MainButton.setText('–¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏');
                tg.MainButton.show();
                
                tg.MainButton.onClick(() => {
                    showResult('mainbutton-result', '‚úÖ MainButton –Ω–∞–∂–∞—Ç!', 'success');
                    tg.MainButton.hide();
                });
                
                showResult('mainbutton-result', '‚úÖ MainButton –ø–æ–∫–∞–∑–∞–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω\n–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞', 'info');
            } catch (error) {
                showResult('mainbutton-result', `‚ùå –û—à–∏–±–∫–∞ MainButton: ${error.message}`, 'error');
            }
        }
        
        function testBackButton() {
            if (!tg?.BackButton) {
                showResult('backbutton-result', '‚ùå BackButton –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
                return;
            }
            
            try {
                tg.BackButton.show();
                
                tg.BackButton.onClick(() => {
                    showResult('backbutton-result', '‚úÖ BackButton –Ω–∞–∂–∞—Ç!', 'success');
                    tg.BackButton.hide();
                });
                
                showResult('backbutton-result', '‚úÖ BackButton –ø–æ–∫–∞–∑–∞–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω\n–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞', 'info');
            } catch (error) {
                showResult('backbutton-result', `‚ùå –û—à–∏–±–∫–∞ BackButton: ${error.message}`, 'error');
            }
        }
        
        function testAllMethods() {
            const results = {};
            
            // –¢–µ—Å—Ç–∏—Ä—É–µ–º –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã
            if (tg?.sendData) {
                try {
                    const result = tg.sendData('{"test": "data"}');
                    results.sendData = { success: true, result: result };
                } catch (error) {
                    results.sendData = { success: false, error: error.message };
                }
            }
            
            if (tg?.postEvent) {
                try {
                    const result = tg.postEvent('test_event', { test: 'data' });
                    results.postEvent = { success: true, result: result };
                } catch (error) {
                    results.postEvent = { success: false, error: error.message };
                }
            }
            
            if (tg?.MainButton) {
                try {
                    tg.MainButton.setText('–¢–µ—Å—Ç');
                    tg.MainButton.show();
                    results.MainButton = { success: true, message: '–ö–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑–∞–Ω–∞' };
                    setTimeout(() => tg.MainButton.hide(), 3000);
                } catch (error) {
                    results.MainButton = { success: false, error: error.message };
                }
            }
            
            showResult('allmethods-result', JSON.stringify(results, null, 2), 'info');
        }
    </script>
</body>
</html>
